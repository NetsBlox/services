const utils = require('../../../../assets/utils');

const INDEX_SNAPSHOT_SHUFFLED = `
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
 <head>
  <title>Index of /data/hurdat</title>
 </head>
 <body>
<h1>Index of /data/hurdat</h1>
  <table>
   <tr><th valign="top"><img src="/icons/blank.gif" alt="[ICO]"></th><th><a href="?C=N;O=D">Name</a></th><th><a href="?C=M;O=A">Last modified</a></th><th><a href="?C=S;O=A">Size</a></th><th><a href="?C=D;O=A">Description</a></th></tr>
   <tr><th colspan="5"><hr></th></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2018-051019.txt">hurdat2-1851-2018-05..&gt;</a></td><td align="right">2019-05-17 15:41  </td><td align="right">5.9M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2018-071519.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2019-07-15 19:18  </td><td align="right">3.4M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2019-052520.txt">hurdat2-1851-2019-05..&gt;</a></td><td align="right">2020-05-26 15:01  </td><td align="right">6.0M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="tracks_atl_readme.txt">tracks_atl_readme.txt</a>  </td><td align="right">2016-01-20 17:32  </td><td align="right">7.1K</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2018-070119.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2019-07-09 14:32  </td><td align="right">3.3M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2019-042820.txt">hurdat2-1851-2019-04..&gt;</a></td><td align="right">2020-04-28 16:46  </td><td align="right">6.1M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2017-050118.txt">hurdat2-1851-2017-05..&gt;</a></td><td align="right">2018-05-01 20:43  </td><td align="right">5.9M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2020-052921.txt">hurdat2-1851-2020-05..&gt;</a></td><td align="right">2021-06-10 15:26  </td><td align="right">6.2M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2020-043021.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2021-05-03 14:14  </td><td align="right">3.4M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2020-043021a.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2021-05-03 14:14  </td><td align="right">3.4M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2020-043021.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2021-05-03 14:14  </td><td align="right">3.4M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/back.gif" alt="[PARENTDIR]"></td><td><a href="/data/">Parent Directory</a>       </td><td>&nbsp;</td><td align="right">  - </td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2018-120319.txt">hurdat2-1851-2018-12..&gt;</a></td><td align="right">2019-12-04 16:58  </td><td align="right">6.0M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2019-040820.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2020-04-09 15:18  </td><td align="right">3.4M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2016-041317.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2017-04-13 14:48  </td><td align="right">3.1M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2019-042320.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2020-04-23 21:02  </td><td align="right">3.4M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/layout.gif" alt="[   ]"></td><td><a href="hurdat2-format-atlantic.pdf">hurdat2-format-atlan..&gt;</a></td><td align="right">2016-01-20 17:32  </td><td align="right"> 69K</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2018-122019.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2019-12-26 20:42  </td><td align="right">3.3M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/layout.gif" alt="[   ]"></td><td><a href="hurdat2-format-nov2019.pdf">hurdat2-format-nov20..&gt;</a></td><td align="right">2019-12-02 14:28  </td><td align="right">411K</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/layout.gif" alt="[   ]"></td><td><a href="hurdat2-format-nencpac.pdf">hurdat2-format-nencp..&gt;</a></td><td align="right">2016-02-26 17:06  </td><td align="right"> 46K</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-nepac-1949-2017-050418.txt">hurdat2-nepac-1949-2..&gt;</a></td><td align="right">2018-05-11 17:54  </td><td align="right">3.2M</td><td>&nbsp;</td></tr>
   <tr><td valign="top"><img src="/icons/text.gif" alt="[TXT]"></td><td><a href="hurdat2-1851-2018-102619.txt">hurdat2-1851-2018-10..&gt;</a></td><td align="right">2019-12-02 14:28  </td><td align="right">6.0M</td><td>&nbsp;</td></tr>
   <tr><th colspan="5"><hr></th></tr>
</table>
</body></html>
`;

describe(utils.suiteName(__filename), () => {
    const hurricane = utils.reqSrc('services/procedures/hurricane-data/hurricane-data.js');
    const assert = require('assert');

    utils.verifyRPCInterfaces('HurricaneData', [
        ['getHurricaneData', ['name', 'year']],
        ['getHurricanesInYear', ['year']],
        ['getYearsWithHurricaneNamed', ['name']],
    ]);

    describe('_extractFiles', () => {
        it('should give most recent files', () => {
            const { baseFile, nepacFile } = hurricane._extractFiles(INDEX_SNAPSHOT_SHUFFLED);
            assert.deepStrictEqual(baseFile.name, 'hurdat2-1851-2020-052921.txt');
            assert.deepStrictEqual(nepacFile.name, 'hurdat2-nepac-1949-2020-043021a.txt');
        });
    });
});
